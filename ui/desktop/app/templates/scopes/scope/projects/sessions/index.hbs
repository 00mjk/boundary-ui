<Rose::Layout::Page as |page|>

  <page.header>
    <h2>{{t "resources.session.title_plural"}}</h2>
  </page.header>

  <page.body>

    {{#if @model}}

      <Rose::Table as |table|>
        <table.header as |header|>
          <header.row as |row|>
            <row.headerCell>{{t "form.id.label"}}</row.headerCell>
            <row.headerCell>{{t "resources.target.title"}}</row.headerCell>
            <row.headerCell>{{t "form.proxy.label"}}</row.headerCell>
            <row.headerCell>{{t "form.started.label"}}</row.headerCell>
            <row.headerCell>{{t "form.status.label"}}</row.headerCell>
            <row.headerCell />
          </header.row>
        </table.header>
        <table.body as |body|>
          {{#each @model as |sessionAggregate|}}
            <body.row as |row|>
              <row.headerCell class="nowrap">
                <Rose::Icon
                  class={{concat "session-status-" sessionAggregate.session.status}}
                  @name="app-icons/action-session"
                  @size="medium" />
                <code>{{sessionAggregate.session.id}}</code>
              </row.headerCell>
              <row.cell>{{sessionAggregate.target.displayName}}</row.cell>
              <row.cell>
                {{!--
                  Two if's here because:
                  1) Local proxy info is only relevant if the session is
                     active or pending (aka isCancelable).  Once the session
                     is canceled or in the process thereof, the local proxy
                     may no longer be used.
                  2) The session actually has proxy information associated
                     with it.  It's possible for the user to start sessions
                     from other devices (or even another tab), in which case we
                     won't have the local proxy info available here.
                --}}
                {{#if sessionAggregate.session.isCancelable}}
                  {{#if sessionAggregate.session.proxy}}
                    <Copyable
                      @text={{sessionAggregate.session.proxy}}
                      @buttonText={{t "actions.copy-to-clipboard"}}
                      @acknowledgeText={{t "states.copied"}}
                    >
                      <code>{{sessionAggregate.session.proxy}}</code>
                    </Copyable>
                  {{/if}}
                {{/if}}
              </row.cell>
              <row.cell>
                <time datetime={{format-date-iso sessionAggregate.session.created_time}}>
                  {{format-date-iso-human sessionAggregate.session.created_time}}
                </time>
              </row.cell>
              <row.cell>
                <Rose::Badge>{{sessionAggregate.session.status}}</Rose::Badge>
              </row.cell>
              <row.cell>
                {{#if sessionAggregate.session.isCancelable}}
                  <Rose::Button @style="secondary" {{on "click" (route-action "cancelSession" sessionAggregate.session)}}>
                    {{t "actions.cancel"}}
                  </Rose::Button>
                {{/if}}
              </row.cell>
            </body.row>
          {{/each}}
        </table.body>
      </Rose::Table>

    {{else}}

      <Rose::Layout::Centered>
        <Rose::Message @title={{t "resources.session.messages.none.title"}} as |message|>
          <message.description>
            {{t "resources.session.messages.none.description"}}
          </message.description>
        </Rose::Message>
      </Rose::Layout::Centered>

    {{/if}}

  </page.body>

</Rose::Layout::Page>
